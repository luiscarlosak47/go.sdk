/* Go.js SDK by Luis Carlos Hurtado - MIT Licence - luiscarloshurtado@live.com */
Go.namespace("nav").init=Go.sleep(100,()=>{Go.includes(location.origin,"luigios.com")&&Go.do("nav/start")}),Go.namespace("nav").start=async function(){document.body.onclick=function(e){var[t,o]=[e.target.href,"_blank"===e.target.target];o||t&&(Go.prevent(e),Go.dispatch("nav.push",t))},window.addEventListener("popstate",function(){Go.dispatch("nav.fetch",window.location.pathname)}),Go.config("routerPreventAutoStart")||Go.dispatch("nav.fetch",window.location.pathname)},Go.namespace("nav").getRouteFullHash=()=>{var e=views[window.location.hash]||views[window.location.hash];return e||=views[window.location.pathname+window.location.hash]},Go.namespace("nav").getRoute=function(e=window.location.pathname,t=window.views){let o=Go.do("nav/getRouteFullHash");o=(o=(o=(o||=t[e]||t[window.location.pathname]||t["/"+window.location.pathname])||t[window.location.pathname+"/"]||t["/"+window.location.pathname+"/"])||t[Go.removeLastStringIf(window.location.pathname,"/")])||t[Go.removeLastStringIf(window.location.hash,"/")];e=Go.url(Go.base()).removeHost(),e=location.href.split(e)[1];return o=e?(o=(o=(o=(o||=t[e])||t["/"+e])||t[e+"/"])||t["/"+e+"/"])||t[Go.removeLastStringIf(e,"/")]:o},Go.namespace("nav").getRouteByName=function(o){let a=!1;return Go.for(views,(e,t)=>{t.name===o&&((a=t).path=e)}),a},Go.namespace("nav").getView=function(e=window.location.pathname){let t=Go.do("nav/getRoute",e);return t=(t=(t||=Go.do("nav/getRouteGlobal",e))||Go.do("nav/getRouteByName",e))||views[404],t=Go.is(t,"function")?t():t},Go.namespace("nav").getRouteGlobal=function(a=window.location.pathname){let n=[!1][0];return Go.for(views,(e,t)=>{var o;Go.includes(e,"*")&&(o=e.split("*")[0],o=Go.removeLastStringIf(o,"/"),Go.includes(a,o))&&(t.parent=e.split("*")[0]||"",n=t)}),n},Go.namespace("nav").fetch=async function(myRoute=window.location.pathname){let[route,si,can]=[Go.dispatch("nav/getView",myRoute),!1,!0];if(route&&(route.if&&Go.is(route.if,"function")?(si=!0,can=await route.if()):Go.is(route.if,"set")&&(si=!0,can=await eval(route.if)),si&&!can&&Go.is(route.else,"function")?route=await route.else():si&&!can&&Go.is(route.else,"string")?route=eval(route.else):si&&!can&&(route=route.else),route||=Go.do("nav/getRouteByName","404"),route)){route.path=location.pathname;const currentRoute=Go.config("currentRoute")||{},nextRoute=route;if(currentRoute.path===nextRoute.path)Go.do("nav/children",route);else{Go.emit("beforeRoute",route);const loader=await Go.loader(Go.config("loaderSelector"));route.components||=[],Go.config("currentRoute",route);let headers=route.headers||{};if(Go.is(headers,"function")&&(headers=headers()),await Go.for(route.styles,e=>{Go.load(Go.eval(e))}),await Go.for(route.components,async e=>{var o=document.querySelector(Go.eval(e.target));if(o){Go.attrs(o,{state:"leaving"});let t="";try{t=await Go.xhr(Go.eval(e.src),{responseType:"text",headers:headers})}catch(e){t=Go.getErrorMessage(e)}Go.attrs(o,{state:"rendering"}),Go.html(o,Go.eval(t)),await Go.sleep(100),Go.attrs(o,{state:"rendered"}),await Go.sleep(100),Go.attrs(o,{state:"loaded"}),o.scrollIntoView()}}),route.html&&route.target){const target=document.querySelector(Go.eval(route.target));if(!target)return;Go.attrs(target,{state:"leaving"}),Go.is(route.html,"function")&&(route.html=await route.html()),Go.attrs(target,{state:"rendering"}),Go.html(target,Go.eval(route.html)),await Go.sleep(100),Go.attrs(target,{state:"rendered"}),await Go.sleep(100),Go.attrs(target,{state:"loaded"}),target.scrollIntoView()}await Go.for(route.scripts,e=>{Go.load(Go.eval(e.src),{...e})}),Go.docTitle(Go.eval(route.title));const fn=route.onRoute||route.onroute||route.fn||route.function||route.do,info={route:route,path:location.pathname};Go.is(fn,"function")?fn(info):fn&&Go.eval(fn),Go.emit("route",info),await Go.sleep(100),Go.do("nav/children",route),document.body.scrollTop=0,loader&&loader.close&&loader.close()}}},Go.namespace("nav").push=function(e){e=Go.fix(e).url(),window.history.pushState({},"",e),window.dispatchEvent(new Event("popstate"))},Go.namespace("nav").refresh=function(){Go.config("currentRoute",{}),window.dispatchEvent(new Event("popstate"))},Go.namespace("nav").query=function(e={}){var t=window.location.href,o=window.location.hash,a=window.location.search;let n=t.replace(a,"");n=n.replace(o,"");t=Go.removeFirstIf(a,"?")+"&"+Go.serializeObject(e),t=Go.quitDuplicateQuery(t),a=n+"?"+t+o;Go.dispatch("nav/push",a),Go.dispatch("nav/refresh")},Go.set("nav").isHome=()=>{return"home"===(Go.config("currentRoute")||{}).name||Go.base()===location.href},Go.set("nav").children=(e={})=>{var t;e.routes&&(t=location.pathname.split(e.parent)[1],t=e.routes[t]||e.routes[t+"/"]||e.routes[Go.removeLastStringIf(t,"/")],t||=e.routes["*"]||e.routes["/*"])&&(Go.config("current/"+e.parent,t),Go.do("nav/loadRoute",t))},Go.set("nav").loadRoute=async(e={})=>{if(e.components){let a=e.headers||{};if(Go.is(a,"function")&&(a=a()),await Go.for(e.components,async e=>{var o=document.querySelector(Go.eval(e.target));if(o){Go.attrs(o,{state:"leaving"});let t="";try{t=await Go.xhr(Go.eval(e.src),{responseType:"text",headers:a})}catch(e){t=Go.getErrorMessage(e)}Go.attrs(o,{state:"rendering"}),Go.html(o,Go.eval(t)),await Go.sleep(100),Go.attrs(o,{state:"rendered"}),await Go.sleep(100),Go.attrs(o,{state:"loaded"})}}),e.html&&e.target){var t=document.querySelector(Go.eval(e.target));if(!t)return;Go.attrs(t,{state:"leaving"}),Go.is(e.html,"function")&&(e.html=await e.html()),Go.attrs(t,{state:"rendering"}),Go.html(t,Go.eval(e.html)),await Go.sleep(100),Go.attrs(t,{state:"rendered"}),await Go.sleep(100),Go.attrs(t,{state:"loaded"})}await Go.for(e.scripts,e=>{Go.load(Go.eval(e.src),{...e})}),(e.onRoute||e.onroute||e.fn||e.function||e.do)&&Go.eval(e.onRoute||e.onroute||e.fn||e.function||e.do),e.title&&(document.title=Go.eval(e.title)),e.routes&&Go.do("nav/children",e)}};