/* Go.js SDK by Luis Carlos Hurtado - MIT Licence - luiscarloshurtado@live.com */
Go.namespace("nav").init=Go.sleep(100,()=>Go.do("nav/start")),Go.namespace("nav").start=async function(){document.body.onclick=function(t){var[e,o]=[t.target.href,"_blank"===t.target.target];o||e&&(Go.prevent(t),Go.dispatch("nav.push",e))},window.addEventListener("popstate",function(){Go.dispatch("nav.fetch",window.location.pathname)}),Go.config("routerPreventAutoStart")||Go.dispatch("nav.fetch",window.location.pathname)},Go.namespace("nav").getRoute=function(t=window.location.pathname,e=window.views){let o=e[t]||e[window.location.pathname]||e["/"+window.location.pathname];t=Go.url(Go.base()).removeHost(),t=location.href.split(t)[1];return o=(o=(o=(o||=e[window.location.pathname+"/"]||e["/"+window.location.pathname+"/"])||e[Go.removeLastStringIf(window.location.pathname,"/")])||(e[window.location.hash]||e[window.location.hash]))||e[Go.removeLastStringIf(window.location.hash,"/")],o=t?(o=(o=(o=(o||=e[t])||e["/"+t])||e[t+"/"])||e["/"+t+"/"])||e[Go.removeLastStringIf(t,"/")]:o},Go.namespace("nav").getRouteByName=function(o){let a=!1;return Go.for(views,(t,e)=>{e.name===o&&((a=e).path=t)}),a},Go.namespace("nav").getView=function(t=window.location.pathname){let e=Go.do("nav/getRoute",t);return e=(e=(e||=Go.do("nav/getRouteGlobal",t))||Go.do("nav/getRouteByName",t))||views[404],e=Go.is(e,"function")?e():e},Go.namespace("nav").getRouteGlobal=function(a=window.location.pathname){let n=[!1][0];return Go.for(views,(t,e)=>{var o;Go.includes(t,"*")&&(o=t.split("*")[0],o=Go.removeLastStringIf(o,"/"),Go.includes(a,o))&&(e.parent=t.split("*")[0]||"",n=e)}),n},Go.namespace("nav").fetch=async function(myRoute=window.location.pathname){let[route,si,can]=[Go.dispatch("nav/getView",myRoute),!1,!0];if(route&&(route.if&&Go.is(route.if,"function")?(si=!0,can=await route.if()):Go.is(route.if,"set")&&(si=!0,can=await eval(route.if)),si&&!can&&Go.is(route.else,"function")?route=await route.else():si&&!can&&Go.is(route.else,"string")?route=eval(route.else):si&&!can&&(route=route.else),route||=Go.do("nav/getRouteByName","404"),route)){route.path=location.pathname;const currentRoute=Go.config("currentRoute")||{},nextRoute=route;if(currentRoute.path===nextRoute.path)Go.do("nav/children",route);else{Go.emit("beforeRoute",route);const loader=await Go.loader(Go.config("loaderSelector"));route.components||=[],Go.config("currentRoute",route);let headers=route.headers||{};if(Go.is(headers,"function")&&(headers=headers()),await Go.for(route.styles,t=>{Go.load(Go.eval(t))}),await Go.for(route.components,async t=>{var o=document.querySelector(Go.eval(t.target));if(o){Go.attrs(o,{state:"leaving"});let e="";try{e=await Go.xhr(Go.eval(t.src),{responseType:"text",headers:headers})}catch(t){e=Go.getErrorMessage(t)}Go.attrs(o,{state:"rendering"}),Go.html(o,Go.eval(e)),await Go.sleep(100),Go.attrs(o,{state:"rendered"}),await Go.sleep(100),Go.attrs(o,{state:"loaded"}),o.scrollIntoView()}}),route.html&&route.target){const target=document.querySelector(Go.eval(route.target));if(!target)return;Go.attrs(target,{state:"leaving"}),Go.is(route.html,"function")&&(route.html=await route.html()),Go.attrs(target,{state:"rendering"}),Go.html(target,Go.eval(route.html)),await Go.sleep(100),Go.attrs(target,{state:"rendered"}),await Go.sleep(100),Go.attrs(target,{state:"loaded"}),target.scrollIntoView()}await Go.for(route.scripts,t=>{Go.load(Go.eval(t.src),{...t})}),Go.docTitle(Go.eval(route.title));const fn=route.onRoute||route.onroute||route.fn||route.function||route.do,info={route:route,path:location.pathname};Go.is(fn,"function")?fn(info):fn&&Go.eval(fn),Go.emit("route",info),await Go.sleep(100),Go.do("nav/children",route),document.body.scrollTop=0,loader&&loader.close&&loader.close()}}},Go.namespace("nav").push=function(t){t=Go.fix(t).url(),window.history.pushState({},"",t),window.dispatchEvent(new Event("popstate"))},Go.namespace("nav").refresh=function(){Go.config("currentRoute",{}),window.dispatchEvent(new Event("popstate"))},Go.namespace("nav").query=function(t={}){var e=window.location.href,o=window.location.hash,a=window.location.search;let n=e.replace(a,"");n=n.replace(o,"");e=Go.removeFirstIf(a,"?")+"&"+Go.serializeObject(t),e=Go.quitDuplicateQuery(e),a=n+"?"+e+o;Go.dispatch("nav/push",a),Go.dispatch("nav/refresh")},Go.set("nav").isHome=()=>{return"home"===(Go.config("currentRoute")||{}).name||Go.base()===location.href},Go.set("nav").children=(t={})=>{var e;t.routes&&(e=location.pathname.split(t.parent)[1],e=t.routes[e]||t.routes[e+"/"]||t.routes[Go.removeLastStringIf(e,"/")],e||=t.routes["*"]||t.routes["/*"])&&(Go.config("current/"+t.parent,e),Go.do("nav/loadRoute",e))},Go.set("nav").loadRoute=async(t={})=>{if(t.components){let a=t.headers||{};if(Go.is(a,"function")&&(a=a()),await Go.for(t.components,async t=>{var o=document.querySelector(Go.eval(t.target));if(o){Go.attrs(o,{state:"leaving"});let e="";try{e=await Go.xhr(Go.eval(t.src),{responseType:"text",headers:a})}catch(t){e=Go.getErrorMessage(t)}Go.attrs(o,{state:"rendering"}),Go.html(o,Go.eval(e)),await Go.sleep(100),Go.attrs(o,{state:"rendered"}),await Go.sleep(100),Go.attrs(o,{state:"loaded"})}}),t.html&&t.target){var e=document.querySelector(Go.eval(t.target));if(!e)return;Go.attrs(e,{state:"leaving"}),Go.is(t.html,"function")&&(t.html=await t.html()),Go.attrs(e,{state:"rendering"}),Go.html(e,Go.eval(t.html)),await Go.sleep(100),Go.attrs(e,{state:"rendered"}),await Go.sleep(100),Go.attrs(e,{state:"loaded"})}await Go.for(t.scripts,t=>{Go.load(Go.eval(t.src),{...t})}),(t.onRoute||t.onroute||t.fn||t.function||t.do)&&Go.eval(t.onRoute||t.onroute||t.fn||t.function||t.do),t.title&&(document.title=Go.eval(t.title)),t.routes&&Go.do("nav/children",t)}};