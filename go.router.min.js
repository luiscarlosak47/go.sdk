/* Go.js SDK by Luis Carlos Hurtado - MIT Licence - luiscarloshurtado@live.com */
Go.namespace("nav").init=Go.sleep(100,()=>{Go.includes(location.origin,"luigios.com")&&Go.do("nav/start")}),Go.namespace("nav").start=async function(){document.body.onclick=function(e){var[o,t]=[e.target.href,"_blank"===e.target.target];t||o&&(Go.prevent(e),Go.dispatch("nav.push",o))},window.addEventListener("popstate",function(){Go.dispatch("nav.fetch",window.location.pathname)}),Go.config("routerPreventAutoStart")||Go.dispatch("nav.fetch",window.location.pathname)},Go.namespace("nav").getRouteFullHash=(e=null)=>{if(window.location.hash)return e=views[window.location.hash]||views[window.location.hash+"/"],(e||=views[window.location.pathname+window.location.hash])||views[Go.removeLastStringIf(window.location.hash,"/")]},Go.namespace("nav").getRoute=function(e=window.location.pathname,o=window.views){let t=Go.do("nav/getRouteFullHash");t=(t=(t||=o[e]||o[window.location.pathname]||o["/"+window.location.pathname])||o[window.location.pathname+"/"]||o["/"+window.location.pathname+"/"])||o[Go.removeLastStringIf(window.location.pathname,"/")];e=Go.url(Go.base()).removeHost(),e=location.href.split(e)[1];return t=e?(t=(t=(t=(t||=o[e])||o["/"+e])||o[e+"/"])||o["/"+e+"/"])||o[Go.removeLastStringIf(e,"/")]:t},Go.namespace("nav").getRouteByName=function(t){let a=!1;return Go.for(views,(e,o)=>{o.name===t&&((a=o).path=e)}),a},Go.namespace("nav").getView=function(e=window.location.pathname){let o=Go.do("nav/getRoute",e);return o=(o=(o||=Go.do("nav/getRouteGlobal",e))||Go.do("nav/getRouteByName",e))||views[404],o=Go.is(o,"function")?o():o},Go.namespace("nav").getRouteGlobal=function(a=window.location.pathname){let n=[!1][0];return Go.for(views,(e,o)=>{var t;Go.includes(e,"*")&&(t=e.split("*")[0],t=Go.removeLastStringIf(t,"/"),Go.includes(a,t))&&(o.parent=e.split("*")[0]||"",n=o)}),n},Go.namespace("nav").fetch=async function(myRoute=window.location.pathname){let[route,si,can]=[Go.dispatch("nav/getView",myRoute),!1,!0];if(route&&(route.if&&Go.is(route.if,"function")?(si=!0,can=await route.if()):Go.is(route.if,"set")&&(si=!0,can=await eval(route.if)),si&&!can&&Go.is(route.else,"function")?route=await route.else():si&&!can&&Go.is(route.else,"string")?route=eval(route.else):si&&!can&&(route=route.else),route||=Go.do("nav/getRouteByName","404"),route)){route.path=location.pathname+location.hash;const currentRoute=Go.config("currentRoute")||{},nextRoute=route;if(currentRoute.path===nextRoute.path)Go.do("nav/children",route);else{Go.emit("beforeRoute",route);const loader=await Go.loader(Go.config("loaderSelector"));route.components||=[],Go.config("currentRoute",route);let headers=route.headers||{};if(Go.is(headers,"function")&&(headers=headers()),await Go.for(route.styles,e=>{Go.load(Go.eval(e))}),await Go.for(route.components,async e=>{var t=document.querySelector(Go.eval(e.target));if(t){Go.attrs(t,{state:"leaving"});let o="";try{o=await Go.xhr(Go.eval(e.src),{responseType:"text",headers:headers})}catch(e){o=Go.getErrorMessage(e)}Go.attrs(t,{state:"rendering"}),Go.html(t,Go.eval(o)),await Go.sleep(100),Go.attrs(t,{state:"rendered"}),await Go.sleep(100),Go.attrs(t,{state:"loaded"}),t.scrollIntoView()}}),route.html&&route.target){const target=document.querySelector(Go.eval(route.target));if(!target)return;Go.attrs(target,{state:"leaving"}),Go.is(route.html,"function")&&(route.html=await route.html()),Go.attrs(target,{state:"rendering"}),Go.html(target,Go.eval(route.html)),await Go.sleep(100),Go.attrs(target,{state:"rendered"}),await Go.sleep(100),Go.attrs(target,{state:"loaded"}),target.scrollIntoView()}await Go.for(route.scripts,e=>{Go.load(Go.eval(e.src),{...e})}),Go.docTitle(Go.eval(route.title));const fn=route.onRoute||route.onroute||route.fn||route.function||route.do,info={route:route,path:location.pathname};Go.is(fn,"function")?fn(info):fn&&Go.eval(fn),Go.emit("route",info),await Go.sleep(100),Go.do("nav/children",route),document.body.scrollTop=0,loader&&loader.close&&loader.close()}}},Go.namespace("nav").push=function(e){e=Go.fix(e).url(),window.history.pushState({},"",e),window.dispatchEvent(new Event("popstate"))},Go.namespace("nav").refresh=function(){Go.config("currentRoute",{}),window.dispatchEvent(new Event("popstate"))},Go.namespace("nav").query=function(e={}){var o=window.location.href,t=window.location.hash,a=window.location.search;let n=o.replace(a,"");n=n.replace(t,"");o=Go.removeFirstIf(a,"?")+"&"+Go.serializeObject(e),o=Go.quitDuplicateQuery(o),a=n+"?"+o+t;Go.dispatch("nav/push",a),Go.dispatch("nav/refresh")},Go.set("nav").isHome=()=>{return"home"===(Go.config("currentRoute")||{}).name||Go.base()===location.href},Go.set("nav").children=(e={})=>{var o;Go.do("nav/markLinks"),e.routes&&(o=location.pathname.split(e.parent)[1],o=e.routes[o]||e.routes[o+"/"]||e.routes[Go.removeLastStringIf(o,"/")],o||=e.routes["*"]||e.routes["/*"])&&(Go.config("current/"+e.parent,o),Go.do("nav/loadRoute",o))},Go.set("nav").loadRoute=async(e={})=>{if(e.components){let a=e.headers||{};if(Go.is(a,"function")&&(a=a()),await Go.for(e.components,async e=>{var t=document.querySelector(Go.eval(e.target));if(t){Go.attrs(t,{state:"leaving"});let o="";try{o=await Go.xhr(Go.eval(e.src),{responseType:"text",headers:a})}catch(e){o=Go.getErrorMessage(e)}Go.attrs(t,{state:"rendering"}),Go.html(t,Go.eval(o)),await Go.sleep(100),Go.attrs(t,{state:"rendered"}),await Go.sleep(100),Go.attrs(t,{state:"loaded"})}}),e.html&&e.target){var o=document.querySelector(Go.eval(e.target));if(!o)return;Go.attrs(o,{state:"leaving"}),Go.is(e.html,"function")&&(e.html=await e.html()),Go.attrs(o,{state:"rendering"}),Go.html(o,Go.eval(e.html)),await Go.sleep(100),Go.attrs(o,{state:"rendered"}),await Go.sleep(100),Go.attrs(o,{state:"loaded"})}await Go.for(e.scripts,e=>{Go.load(Go.eval(e.src),{...e})}),(e.onRoute||e.onroute||e.fn||e.function||e.do)&&Go.eval(e.onRoute||e.onroute||e.fn||e.function||e.do),e.title&&(document.title=Go.eval(e.title)),e.routes&&Go.do("nav/children",e)}},Go.set("nav").markLinks=()=>{var e=document.querySelectorAll("a"),e=(Go.for(e,e=>{location.href===e.href?e.classList.add("active"):e.classList.remove("active")}),Go.url(location.href).removeBase());Go.cssTag("nav",`a[href*="${e}"]{color: var(--link-active-color);}`)};